<template id="item-template">
  <div class="card item-card border-0 shadow-sm rounded-4" data-index="">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start mb-2 gap-3 position-relative">
        <div class="order-position w-100 text-center">
          Позиція <span class="pos-index">1</span>
        </div>
        {% if order.status == order.STATUS_QUOTE %}
          <button type="button" class="btn btn-sm btn-outline-danger remove-row position-absolute end-0 top-0" aria-label="Видалити позицію"><i class="bi bi-x-lg"></i></button>
        {% endif %}
      </div>

      <div class="row g-3">
        <!-- Система + колір системи -->
        <div class="col-12 col-md-3">
          <label class="form-label"><strong>Система</strong></label>
          <select name="system_sheet" class="form-select system-sheet">
            <!-- опції підставляються з JS (вкладки з Google Sheets) -->
          </select>

          <br />
          <br />
          <br />
          <label class="form-label mt-3"><strong>Колір системи</strong></label>
          <select name="table_section" class="form-select table-section" disabled>
            <option value="">Спочатку оберіть систему…</option>
          </select>
        </div>

        <!-- Тканина + габаритна висота -->
        <div class="col-12 col-md-3">
          <label class="form-label"><strong>Тканина</strong></label>
          <select name="fabric_name" class="form-select fabric" disabled>
            <option value="">Спочатку оберіть колір системи…</option>
          </select>
          <br />
          <br />
          <br />
          <div class="mb-2 mt-3">
            <label class="form-label"><strong>Колір тканини</strong></label>
            <select name="fabric_color_code" class="form-select fabric-color-code">
              <option value="" selected disabled>— Оберіть колір —</option>
            </select>
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-6">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label"><strong>Ширина, мм</strong></label>
              <input type="number" min="0" name="width_fabric_mm" class="form-control w-mm mb-2" placeholder="введіть мм" disabled />
              <div class="form-check mt-1 gabarit-width-flag">
                <input class="form-check-input bottom-fixation" type="checkbox" name="gabarit_width_flag" disabled>
                <label class="form-check-label ms-1 gabarit-width-label">Габаритна ширина</label>
              </div>
              <div class="mt-3 height-block">
                <label class="form-label"><strong>Висота, мм</strong></label>
                <input type="number" min="0" name="height_gabarit_mm" class="form-control h-mm" placeholder="введіть мм" disabled />
                <div class="form-check mt-1 fabric-height-flag">
                  <input class="form-check-input" type="checkbox" name="fabric_height_flag" disabled>
                  <label class="form-check-label ms-1">Висота по тканині</label>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="control_side d-none mb-3">
                <label class="form-label"><strong>Сторона керування</strong></label>
                <select name="control_side" class="form-select">
                  <option value="">— Не вказано —</option>
                  <option value="left">Ліворуч</option>
                  <option value="right">Праворуч</option>
                </select>
              </div>
              <label class="form-label mt-3"><strong>Кількість виробів</strong></label>
              <input type="number" name="quantity" class="form-control qty" min="1" step="1" value="1" disabled />
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <label class="form-label"><strong>Примітка по позиції</strong></label>
          <textarea class="form-control item-note" name="item_note" rows="2" placeholder="Додайте примітку щодо цієї позиції"></textarea>
        </div>
      </div>

      <div class="row">
        <div class="col-12 col-md-12 op-card-list mt-4">
          <input type="hidden" name="base_price_eur" class="base-input" />
          <input type="hidden" name="gb_width_mm" class="gb_width_mm" />
          <input type="hidden" name="surcharge_height_eur" class="surcharge-input" />
          <input type="hidden" name="subtotal_eur" class="subtotal-input" />
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12 col-md-5">
          <div class="price-box border rounded-3 p-3">
            <div class="table-responsive">
              <table class="table table-sm mb-0 align-middle">
                <thead>
                  <tr>
                    <th class="w-50">Позиція</th>
                    <th class="text-end">Ціна од.</th>
                    <th class="text-center">К-ть</th>
                    <th class="text-end">Разом</th>
                  </tr>
                </thead>
                <tbody class="price-options-manifest">
                  <!-- Базовая часть (система) -->
                  <tr class="system-row">
                    <td>Виріб</td>
                    <td class="text-end">
                      <span class="base" style="display:none;">0.00</span>
                      <div class="">
                        <span class="base-uah">0.00</span>
                      </div>
                    </td>
                    <td class="text-center"></td>
                    <td class="text-end"></td>
                  </tr>

                  <!-- Надбавка за высоту -->
                  <tr class="surcharge-row d-none">
                    <td>Допис висоти</td>
                    <td class="text-end">
                      <span class="surcharge" style="display:none;">0.00</span>
                      <div class="">
                        <span class="surcharge-uah">0.00</span>
                      </div>
                    </td>
                    <td class="text-center"></td>
                    <td class="text-end"></td>
                  </tr>

                  <!-- Строки опций будут добавляться JS ТОЛЬКО при чекбоксе -->
                </tbody>
              </table>
            </div>

            <hr class="my-2" />
            <div class="d-flex justify-content-between">
              <span>Ціна позиції</span>
              <span class="text-end">
              <span class="subtotal-input" style="display:none;">0.00</span>
              <span class="subtotal-uah ms-2">0.00</span>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
