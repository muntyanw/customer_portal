{% extends "core/base.html" %}
{% load form_tags %}
{% block title %}Реєстрація — Портал{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-center min-vh-100 bg-light">
  <div class="col-11 col-sm-8 col-md-6 col-lg-4">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body p-4">
        <div class="text-center mb-4">
          <img src="/static/img/logo.svg" alt="logo" width="64" height="64" class="mb-2">
          <h1 class="h4 fw-semibold mb-0">Створення акаунту</h1>
          <p class="text-muted small mb-0">Заповніть форму, щоб продовжити</p>
        </div>

        {# Non-field errors (UA/EN) #}
        {% if form.non_field_errors %}
          <div class="alert alert-danger py-2" role="alert">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <form method="post" novalidate>
          {% csrf_token %}

          <div class="mb-3">
            {{ form.email.label_tag }}
            {{ form.email|add_class:"form-control form-control-lg" }}
            {% if form.email.errors %}
              <div class="invalid-feedback d-block">{{ form.email.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.password.label_tag }}
            <div class="input-group input-group-lg">
              {{ form.password|add_class:"form-control" }}
              <button class="btn btn-outline-secondary" type="button" id="togglePwd1" aria-label="Show/hide">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            {% if form.password.errors %}
              <div class="invalid-feedback d-block">{{ form.password.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.password2.label_tag }}
            <div class="input-group input-group-lg">
              {{ form.password2|add_class:"form-control" }}
              <button class="btn btn-outline-secondary" type="button" id="togglePwd2" aria-label="Show/hide">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            {% if form.password2.errors %}
              <div class="invalid-feedback d-block">{{ form.password2.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="form-text mb-3">
            Пароль має бути надійним (рекомендується ≥ 8 символів, літери + цифри).
          </div>

          <div class="d-grid mt-2">
            <button type="submit" class="btn btn-primary btn-lg">Зареєструватися</button>
          </div>
        </form>

        <hr class="my-4">
        <p class="text-center small mb-0">
          Вже маєте акаунт?
          <a href="{% url 'accounts:login' %}" class="fw-semibold">Увійти</a>
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block head_extra %}
  {{ block.super }}
  <!-- Bootstrap Icons (for eye icon) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}

{% block body_extra %}
  {{ block.super }}
  <script>
    // UA: Перемикач видимості паролів; EN: Toggle password visibility
    (function(){
      function toggle(btnId, inputSelector) {
        const btn = document.getElementById(btnId);
        if (!btn) return;
        btn.addEventListener('click', function(){
          const input = document.querySelector(inputSelector);
          if (!input) return;
          const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
          input.setAttribute('type', type);
          const icon = this.querySelector('i');
          if (icon) icon.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
        });
      }
      toggle('togglePwd1', 'input[name="password"]');
      toggle('togglePwd2', 'input[name="password2"]');
    })();
  </script>
{% endblock %}
